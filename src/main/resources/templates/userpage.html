<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
    <head th:replace="fragments :: head('User page', '')" />
    <body>
        <header th:replace="fragments :: header" />
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="card-group">
                        <div class="card">
                            <img th:if="${account.avatar}" class="card-img-top" th:src="@{/images/{id}/content(id=${account.avatar.id})}" alt="Avatar" />
                            <img th:unless="${account.avatar}" class="card-img-top" src="data:image/png;base64,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" alt="Avatar" />
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <div class="alert alert-info" role="alert">
                                    <p><a th:href="@{/friend/{profileurl}/request(profileurl=${account.profileurl})}" th:unless="${isme || isfriend || iswaitingaccept || isfriendrequested}">Send friend request</a></p>
                                    <p><a th:href="@{/friend/{profileurl}/accept(profileurl=${account.profileurl})}" th:if="${iswaitingaccept}">Accept friend request</a></p>
                                    <p><a th:href="@{/friend/{profileurl}/reject(profileurl=${account.profileurl})}" th:if="${iswaitingaccept}">Reject friend request</a></p>
                                    <p th:if="${isfriend}">Is a friend</p>
                                    <p th:if="${isfriendrequested}">Friend request pending</p>
                                    <p th:if="${isme}">This is your page</p>
                                </div>
                            </div>
                        </div>
                        <div class="card" th:if="${isme || isfriend}">
                            <div class="card-body">
                                <form method="POST" th:action="@{/users/{profileurl}/message(profileurl=${account.profileurl})}">
                                    <div class="form-group">
                                        <textarea class="form-control" name="message" id="message"></textarea>
                                    </div>
                                    <input type="submit" class="btn btn-primary" value="Post message to wall"/>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-12">
                    <div class="row" th:each="message,iterStatM : ${messages}" th:if="${iterStatM.index}<25">
                        <div class="col-12">
                            <div class="card mb-2">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-8">
                                            <a th:href="@{/users/{profileurl}(profileurl=${message.sender.profileurl})}" th:text="${message.sender.nickname}+':'"></a>
                                            <span class="card-text"  th:text="${message.message}"></span>   
                                        </div>
                                        <div class="col-3">
                                            <span class="text-muted float-right" th:text="${#temporals.format(message.creationtime, 'HH:mm dd-MM-yyyy')}"></span>
                                        </div>
                                        <div class="col-1">
                                            <span th:text="${#lists.size(message.likes)}"></span> likes
                                            <form th:if="${isfriend && not #lists.contains(message.likes, me.id)}" th:method="POST" th:action="@{/users/{profileurl}/message/{messageid}/like(profileurl=${account.profileurl}, messageid=${message.id})}">
                                                <input type="submit" class="btn btn-primary" value="Like"/>
                                            </form>
                                            <form th:if="${isfriend && #lists.contains(message.likes, me.id)}" th:method="POST" th:action="@{/users/{profileurl}/message/{messageid}/unlike(profileurl=${account.profileurl}, messageid=${message.id})}">
                                                <input type="submit" class="btn btn-primary" value="Unlike"/>
                                            </form>
                                        </div>
                                    </div>

                                    <ul th:if="${not #lists.isEmpty(message.comments)}" class="mt-4 list-group list-group-flush">
                                        <li class="list-group-item" th:each="comment,iterStatC : ${message.comments}" th:if="${iterStatC.index}<10">
                                            <a th:href="@{/users/{profileurl}(profileurl=${comment.sender.profileurl})}" th:text="${comment.sender.nickname}+':'"></a>
                                            <span th:text="${comment.message}"></span>
                                            <span class="text-muted float-right" th:text="${#temporals.format(comment.creationtime, 'HH:mm dd-MM-yyyy')}"></span>
                                        </li>
                                    </ul>
                                </div>
                                <div class="card-footer" th:if="${isme || isfriend}">
                                    <form method="POST" th:action="@{/users/{profileurl}/message/{messageid}/comment(profileurl=${account.profileurl}, messageid=${message.id})}">
                                        <div class="form-group">
                                            <textarea class="form-control" name="comment" id="comment"></textarea>
                                        </div>
                                        <input type="submit" class="btn btn-primary" value="Send comment"/>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer th:replace="fragments :: footer" />
    </body>
</html>
